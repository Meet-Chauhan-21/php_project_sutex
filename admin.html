<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #1a202c;
    }

    /* Login Section */
    .login-section {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-card {
      background: rgba(255, 255, 255, 0.95);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 48px 40px;
      box-shadow: 0 32px 64px rgba(0, 0, 0, 0.12);
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .login-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      color: white;
      font-size: 32px;
    }

    .login-title {
      font-size: 28px;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 8px;
    }

    .login-subtitle {
      color: #718096;
      font-size: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #2d3748;
      font-size: 13px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f7fafc;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .login-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 8px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(102, 126, 234, 0.3);
    }

    .login-info {
      margin-top: 24px;
      padding: 16px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 12px;
      text-align: center;
      font-size: 14px;
      color: #4a5568;
    }

    .back-home-btn {
      margin-top: 16px;
      width: 100%;
      padding: 12px 24px;
      background: #e2e8f0;
      color: #2d3748;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
    }

    .back-home-btn:hover {
      background: #cbd5e0;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    /* Dashboard Section */
    .dashboard-container {
      min-height: 100vh;
      background: #f7fafc;
      display: flex;
    }

    .sidebar {
      width: 220px;
      background: white;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.05);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 20px 16px 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .sidebar-logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
    }

    .sidebar-logo-text {
      font-size: 16px;
      font-weight: 700;
      color: #1a202c;
    }

    .admin-info {
      background: #f7fafc;
      padding: 12px;
      border-radius: 12px;
    }

    .admin-info h4 {
      font-size: 12px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .admin-email {
      font-weight: 600;
      color: #2d3748;
      font-size: 14px;
    }

    .nav-menu {
      padding: 24px 0;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: #4a5568;
      text-decoration: none;
      transition: all 0.2s ease;
      font-weight: 500;
      font-size: 14px;
    }

    .nav-link:hover {
      background: #f7fafc;
      color: #667eea;
    }

    .nav-link.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-radius: 0 20px 20px 0;
      margin-right: 16px;
    }

    .nav-link i {
      font-size: 16px;
      width: 20px;
    }

    .main-content {
      margin-left: 220px;
      flex: 1;
      min-height: 100vh;
    }

    .main-header {
      background: white;
      padding: 16px 24px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: #1a202c;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #f7fafc;
      color: #4a5568;
      border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover {
      background: #edf2f7;
    }

    .btn-danger {
      background: linear-gradient(135deg, #fc8181, #f56565);
      color: white;
    }

    .content-area {
      padding: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: white;
      padding: 20px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-title {
      font-size: 14px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
    }

    .stat-icon.users { background: linear-gradient(135deg, #48bb78, #38a169); }
    .stat-icon.applications { background: linear-gradient(135deg, #667eea, #764ba2); }
    .stat-icon.pending { background: linear-gradient(135deg, #ed8936, #dd6b20); }
    .stat-icon.approved { background: linear-gradient(135deg, #48bb78, #38a169); }

    .stat-value {
      font-size: 36px;
      font-weight: 800;
      color: #1a202c;
      margin-bottom: 4px;
    }

    .stat-change {
      font-size: 14px;
      color: #48bb78;
      font-weight: 500;
    }

    .card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
      border: 1px solid #e2e8f0;
      margin-bottom: 32px;
      overflow: hidden;
    }

    .card-header {
      padding: 24px 32px;
      border-bottom: 1px solid #e2e8f0;
      background: #f7fafc;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 4px;
    }

    .card-subtitle {
      color: #718096;
      font-size: 14px;
    }

    .card-content {
      padding: 32px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .table-container {
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table thead {
      background: #f7fafc;
    }

    .table th,
    .table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
      font-size: 13px;
    }

    .table th {
      font-weight: 600;
      color: #2d3748;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .table tr:hover {
      background: #f7fafc;
    }

    .status-select {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      font-size: 14px;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 12px;
      border-radius: 8px;
    }

    .logs-container {
      background: #f7fafc;
      border-radius: 16px;
      padding: 24px;
      max-height: 500px;
      overflow-y: auto;
    }

    .log-entry {
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 14px;
      line-height: 1.6;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .hidden {
      display: none !important;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 10000;
      padding: 16px 24px;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      max-width: 400px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(135deg, #48bb78, #38a169);
    }

    .notification.error {
      background: linear-gradient(135deg, #fc8181, #f56565);
    }

    .notification.info {
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .main-header {
        padding: 12px 16px;
      }

      .content-area {
        padding: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .page-title {
        font-size: 24px;
      }

      .menu-toggle {
        display: block;
        background: none;
        border: none;
        font-size: 20px;
        color: #4a5568;
        cursor: pointer;
        margin-right: 16px;
      }
    }

    .menu-toggle {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div id="loginSection" class="login-section">
    <div class="login-card">
      <div class="login-header">
        <div class="login-logo">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <h1 class="login-title">Admin</h1>
        <p class="login-subtitle">Secure Administrative Portal</p>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Admin Email</label>
          <input type="email" id="adminUser" class="form-input" placeholder="mohit@gmail.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" id="adminPass" class="form-input" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="login-btn">
          <i class="fas fa-sign-in-alt"></i>
          Sign In Securely
        </button>
      </form>

      <div class="login-info">
        <i class="fas fa-info-circle"></i>
        Default credentials: mohit@gmail.com
      </div>

      <a href="index.html" class="back-home-btn">
        <i class="fas fa-home"></i>
        Back to Home
      </a>
    </div>
  </div>

  <!-- Dashboard Section -->
  <div id="dashboardSection" class="dashboard-container hidden">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <span class="sidebar-logo-text"></span>
        </div>
        <div class="admin-info">
          <h4>Logged in as</h4>
          <div class="admin-email" id="adminEmail">mohit@gmail.com</div>
        </div>
      </div>

      <nav class="nav-menu">
        <div class="nav-item">
          <a href="#" class="nav-link active" data-section="dashboard">
            <i class="fas fa-chart-pie"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="applications">
            <i class="fas fa-file-alt"></i>
            <span>Applications</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="users">
            <i class="fas fa-users"></i>
            <span>Users</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-section="audit">
            <i class="fas fa-history"></i>
            <span>Audit Logs</span>
          </a>
        </div>
        <div class="nav-item" style="margin-top: auto; border-top: 1px solid #e2e8f0; padding-top: 16px;">
          <a href="#" class="nav-link" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="main-header">
        <div style="display: flex; align-items: center;">
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="refreshBtn">
            <i class="fas fa-sync"></i>
            Refresh
          </button>
          <button class="btn btn-danger" id="logoutBtnHeader">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </button>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Dashboard Content -->
        <section id="dashboardContent" class="content-section">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-title">Total Users</div>
                <div class="stat-icon users">
                  <i class="fas fa-users"></i>
                </div>
              </div>
              <div class="stat-value" id="statUsers">0</div>
              <div class="stat-change">+12% from last month</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-title">Applications</div>
                <div class="stat-icon applications">
                  <i class="fas fa-file-alt"></i>
                </div>
              </div>
              <div class="stat-value" id="statApps">0</div>
              <div class="stat-change">+8% from last month</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-title">Pending</div>
                <div class="stat-icon pending">
                  <i class="fas fa-clock"></i>
                </div>
              </div>
              <div class="stat-value" id="statPending">0</div>
              <div class="stat-change">Requires review</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-title">Approved</div>
                <div class="stat-icon approved">
                  <i class="fas fa-check-circle"></i>
                </div>
              </div>
              <div class="stat-value" id="statApproved">0</div>
              <div class="stat-change">+15% from last month</div>
            </div>
          </div>
        </section>

        <!-- Applications Content -->
        <section id="applicationsContent" class="content-section hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Add New Application</div>
              <div class="card-subtitle">Create a new course application entry</div>
            </div>
            <div class="card-content">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Full Name</label>
                  <input type="text" id="appFullName" class="form-input" placeholder="Enter full name">
                </div>
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" id="appEmail" class="form-input" placeholder="Enter email">
                </div>
                <div class="form-group">
                  <label class="form-label">Phone</label>
                  <input type="tel" id="appPhone" class="form-input" placeholder="Enter phone">
                </div>
                <div class="form-group">
                  <label class="form-label">Program</label>
                  <input type="text" id="appProgram" class="form-input" placeholder="Enter program">
                </div>
                <div class="form-group">
                  <label class="form-label">Status</label>
                  <select id="appStatus" class="form-input">
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="form-group" style="display: flex; align-items: end;">
                  <button class="btn btn-primary" id="addAppBtn">
                    <i class="fas fa-plus"></i>
                    Add Application
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Course Applications</div>
              <div class="card-subtitle">Manage all course applications</div>
            </div>
            <div class="card-content">
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Program</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="appsBody">
                    <!-- Applications will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Users Content -->
        <section id="usersContent" class="content-section hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Add New User</div>
              <div class="card-subtitle">Create a new user account</div>
            </div>
            <div class="card-content">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">First Name</label>
                  <input type="text" id="uFirst" class="form-input" placeholder="Enter first name">
                </div>
                <div class="form-group">
                  <label class="form-label">Last Name</label>
                  <input type="text" id="uLast" class="form-input" placeholder="Enter last name">
                </div>
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" id="uEmail" class="form-input" placeholder="Enter email">
                </div>
                <div class="form-group">
                  <label class="form-label">Phone</label>
                  <input type="tel" id="uPhone" class="form-input" placeholder="Enter phone">
                </div>
                <div class="form-group">
                  <label class="form-label">Program</label>
                  <input type="text" id="uProgram" class="form-input" placeholder="Enter program">
                </div>
                <div class="form-group" style="display: flex; align-items: end;">
                  <button class="btn btn-primary" id="addUserBtn">
                    <i class="fas fa-user-plus"></i>
                    Add User
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">Registered Users</div>
              <div class="card-subtitle">Manage all registered users</div>
            </div>
            <div class="card-content">
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Program</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="usersBody">
                    <!-- Users will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Audit Logs Content -->
        <section id="auditContent" class="content-section hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Audit Logs</div>
              <div class="card-subtitle">System activity and change history</div>
            </div>
            <div class="card-content">
              <div class="logs-container" id="logsContainer">
                <!-- Logs will be populated here -->
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // API helper function
    const api = (path, opts = {}) => {
      return fetch('php/' + path, {
        credentials: 'include',
        ...opts
      }).then(response => response.json());
    };

    // Global state
    let currentSection = 'dashboard';
    let dashboardData = null;

    // Initialize application
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      // Login form handler
      document.getElementById('loginForm').addEventListener('submit', handleLogin);

      // Navigation handlers
      document.querySelectorAll('.nav-link[data-section]').forEach(link => {
        link.addEventListener('click', handleNavigation);
      });

      // Button handlers
      document.getElementById('refreshBtn').addEventListener('click', refreshData);
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
      document.getElementById('logoutBtnHeader').addEventListener('click', handleLogout);
      document.getElementById('addAppBtn').addEventListener('click', addApplication);
      document.getElementById('addUserBtn').addEventListener('click', addUser);

      // Mobile menu toggle
      document.getElementById('menuToggle').addEventListener('click', toggleMobileMenu);
    }

    // Login handler
    async function handleLogin(e) {
      e.preventDefault();
      
      const username = document.getElementById('adminUser').value.trim();
      const password = document.getElementById('adminPass').value;
      
      if (!username || !password) {
        showNotification('Please enter both email and password', 'error');
        return;
      }

      try {
        const response = await api('admin_login.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        if (response.success) {
          document.getElementById('loginSection').classList.add('hidden');
          document.getElementById('dashboardSection').classList.remove('hidden');
          document.getElementById('adminEmail').textContent = username;
          
          await loadDashboard();
          showNotification('Login successful!', 'success');
        } else {
          showNotification(response.error || 'Login failed', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showNotification('Network error. Please try again.', 'error');
      }
    }

    // Navigation handler
    function handleNavigation(e) {
      e.preventDefault();
      const section = e.target.closest('.nav-link').getAttribute('data-section');
      switchSection(section);
    }

    // Switch sections
    function switchSection(section) {
      // Update active nav link
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      document.querySelector(`[data-section="${section}"]`).classList.add('active');

      // Hide all content sections
      document.querySelectorAll('.content-section').forEach(content => {
        content.classList.add('hidden');
      });

      // Show selected section
      const targetContent = document.getElementById(section + 'Content');
      if (targetContent) {
        targetContent.classList.remove('hidden');
      }

      // Update page title
      const titles = {
        dashboard: 'Dashboard',
        applications: 'Course Applications',
        users: 'User Management',
        audit: 'Audit Logs'
      };
      document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';

      currentSection = section;

      // Load section-specific data
      loadSectionData(section);
    }

    // Load section data
    async function loadSectionData(section) {
      switch (section) {
        case 'applications':
          await loadApplications();
          break;
        case 'users':
          await loadUsers();
          break;
        case 'audit':
          await loadAuditLogs();
          break;
      }
    }

    // Load dashboard data
    async function loadDashboard() {
      try {
        const response = await api('admin_dashboard_data.php');
        
        if (!response.success) {
          showNotification('Failed to load dashboard data', 'error');
          return;
        }

        dashboardData = response;

        // Update statistics with animation
        animateValue('statUsers', response.summary.users);
        animateValue('statApps', response.summary.applications);
        animateValue('statPending', response.summary.pending_applications);
        animateValue('statApproved', response.summary.approved_applications);

      } catch (error) {
        console.error('Dashboard error:', error);
        showNotification('Failed to load dashboard', 'error');
      }
    }

    // Load applications
    async function loadApplications() {
      try {
        const response = await api('applications_crud.php');
        
        if (!response.success) {
          showNotification('Failed to load applications', 'error');
          return;
        }

        const tbody = document.getElementById('appsBody');
        tbody.innerHTML = '';

        response.data.forEach((app, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${escapeHtml(app.full_name)}</td>
            <td>${escapeHtml(app.email)}</td>
            <td>${escapeHtml(app.program_applied)}</td>
            <td>
              <select class="status-select" data-id="${app.id}">
                <option value="pending" ${app.status === 'pending' ? 'selected' : ''}>Pending</option>
                <option value="approved" ${app.status === 'approved' ? 'selected' : ''}>Approved</option>
                <option value="rejected" ${app.status === 'rejected' ? 'selected' : ''}>Rejected</option>
              </select>
            </td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteApplication(${app.id})">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });

        // Add status change handlers
        document.querySelectorAll('.status-select').forEach(select => {
          select.addEventListener('change', async (e) => {
            const id = e.target.getAttribute('data-id');
            const status = e.target.value;
            await updateApplicationStatus(id, status);
          });
        });

      } catch (error) {
        console.error('Applications error:', error);
        showNotification('Failed to load applications', 'error');
      }
    }

    // Load users
    async function loadUsers() {
      try {
        const response = await api('users_crud.php');
        
        if (!response.success) {
          showNotification('Failed to load users', 'error');
          return;
        }

        const tbody = document.getElementById('usersBody');
        tbody.innerHTML = '';

        response.data.forEach((user, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${escapeHtml(user.first_name)} ${escapeHtml(user.last_name)}</td>
            <td>${escapeHtml(user.email)}</td>
            <td>${escapeHtml(user.phone || 'N/A')}</td>
            <td>${escapeHtml(user.program || 'N/A')}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });

      } catch (error) {
        console.error('Users error:', error);
        showNotification('Failed to load users', 'error');
      }
    }

    // Load audit logs
    async function loadAuditLogs() {
      if (!dashboardData) {
        await loadDashboard();
      }

      const container = document.getElementById('logsContainer');
      container.innerHTML = '';

      if (dashboardData && dashboardData.auditLogs) {
        dashboardData.auditLogs.forEach(log => {
          const logEntry = document.createElement('div');
          logEntry.className = 'log-entry';
          logEntry.innerHTML = `
            <strong>[${formatDate(log.created_at)}]</strong>
            Admin <em>${escapeHtml(log.admin_username)}</em> performed 
            <strong>${escapeHtml(log.action)}</strong> on 
            <em>${escapeHtml(log.target_table)}#${log.target_id}</em>
            ${log.details ? '<br><small>' + escapeHtml(log.details) + '</small>' : ''}
          `;
          container.appendChild(logEntry);
        });
      } else {
        container.innerHTML = '<div class="log-entry">No audit logs available</div>';
      }
    }

    // Add application
    async function addApplication() {
      const fullName = document.getElementById('appFullName').value.trim();
      const email = document.getElementById('appEmail').value.trim();
      const phone = document.getElementById('appPhone').value.trim();
      const program = document.getElementById('appProgram').value.trim();
      const status = document.getElementById('appStatus').value;

      if (!fullName || !email || !program) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }

      try {
        const response = await api('applications_crud.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            full_name: fullName,
            email: email,
            phone: phone,
            program_applied: program,
            status: status
          })
        });

        if (response.success) {
          showNotification('Application added successfully!', 'success');
          clearForm(['appFullName', 'appEmail', 'appPhone', 'appProgram']);
          await loadApplications();
          await loadDashboard();
        } else {
          showNotification('Failed to add application', 'error');
        }
      } catch (error) {
        console.error('Add application error:', error);
        showNotification('Failed to add application', 'error');
      }
    }

    // Add user
    async function addUser() {
      const firstName = document.getElementById('uFirst').value.trim();
      const lastName = document.getElementById('uLast').value.trim();
      const email = document.getElementById('uEmail').value.trim();
      const phone = document.getElementById('uPhone').value.trim();
      const program = document.getElementById('uProgram').value.trim();

      if (!firstName || !lastName || !email) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }

      try {
        const response = await api('users_crud.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            first_name: firstName,
            last_name: lastName,
            email: email,
            phone: phone,
            program: program,
            registration_date: new Date().toISOString().slice(0, 19).replace('T', ' ')
          })
        });

        if (response.success) {
          showNotification('User added successfully!', 'success');
          clearForm(['uFirst', 'uLast', 'uEmail', 'uPhone', 'uProgram']);
          await loadUsers();
          await loadDashboard();
        } else {
          showNotification('Failed to add user', 'error');
        }
      } catch (error) {
        console.error('Add user error:', error);
        showNotification('Failed to add user', 'error');
      }
    }

    // Update application status
    async function updateApplicationStatus(id, status) {
      try {
        const response = await api(`applications_crud.php?id=${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: status })
        });

        if (response.success) {
          showNotification('Application status updated!', 'success');
          await loadDashboard();
        } else {
          showNotification('Failed to update status', 'error');
        }
      } catch (error) {
        console.error('Update status error:', error);
        showNotification('Failed to update status', 'error');
      }
    }

    // Delete application
    async function deleteApplication(id) {
      if (!confirm('Are you sure you want to delete this application?')) {
        return;
      }

      try {
        const response = await api(`applications_crud.php?id=${id}`, {
          method: 'DELETE'
        });

        if (response.success) {
          showNotification('Application deleted successfully!', 'success');
          await loadApplications();
          await loadDashboard();
        } else {
          showNotification('Failed to delete application', 'error');
        }
      } catch (error) {
        console.error('Delete application error:', error);
        showNotification('Failed to delete application', 'error');
      }
    }

    // Delete user
    async function deleteUser(id) {
      if (!confirm('Are you sure you want to delete this user?')) {
        return;
      }

      try {
        const response = await api(`users_crud.php?id=${id}`, {
          method: 'DELETE'
        });

        if (response.success) {
          showNotification('User deleted successfully!', 'success');
          await loadUsers();
          await loadDashboard();
        } else {
          showNotification('Failed to delete user', 'error');
        }
      } catch (error) {
        console.error('Delete user error:', error);
        showNotification('Failed to delete user', 'error');
      }
    }

    // Refresh data
    async function refreshData() {
      showNotification('Refreshing data...', 'info');
      await loadDashboard();
      await loadSectionData(currentSection);
      showNotification('Data refreshed successfully!', 'success');
    }

    // Logout handler
    async function handleLogout() {
      if (confirm('Are you sure you want to logout?')) {
        try {
          await api('admin_logout.php');
        } catch (error) {
          console.error('Logout error:', error);
        }
        window.location.reload();
      }
    }

    // Toggle mobile menu
    function toggleMobileMenu() {
      document.getElementById('sidebar').classList.toggle('show');
    }

    // Utility functions
    function clearForm(fieldIds) {
      fieldIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.value = '';
        }
      });
    }

    function animateValue(elementId, targetValue) {
      const element = document.getElementById(elementId);
      if (!element) return;

      const startValue = parseInt(element.textContent) || 0;
      const duration = 1000;
      const startTime = performance.now();

      function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
        
        element.textContent = currentValue;
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      }
      
      requestAnimationFrame(animate);
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleString();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showNotification(message, type = 'info') {
      // Remove existing notification
      const existing = document.querySelector('.notification');
      if (existing) {
        existing.remove();
      }

      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        ${escapeHtml(message)}
      `;

      document.body.appendChild(notification);

      // Show notification
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);

      // Hide notification after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menuToggle');
      
      if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
        sidebar.classList.remove('show');
      }
    });
  </script>
</body>
</html>
