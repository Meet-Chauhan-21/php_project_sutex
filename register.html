<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Register for VidyaGuru College - Create your student account">
    <meta name="keywords" content="register, signup, student, account, VidyaGuru, college">
    <meta name="author" content="VidyaGuru College">
    <title>Register - VidyaGuru College</title>
    <link rel="stylesheet" href="assets/fonts-local.css">
    <link rel="stylesheet" href="assets/fontawesome-local.css?v=2024-icons">
    <link rel="stylesheet" href="new.css?v=2024">
    <link rel="stylesheet" href="assets/professional-enhancements.css">
    <link rel="stylesheet" href="assets/compact-design.css">
    <link rel="stylesheet" href="assets/auth-pages.css">
    <link rel="icon" type="image/svg+xml" href="cc_logo.svg">
    
    <!-- Google OAuth 2.0 API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Header -->
    <header id="header">
        <div class="container header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">VG</div>
                <span>VidyaGuru</span>
            </a>
            <nav id="nav" role="navigation" aria-label="Main navigation">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#programs">Programs</a></li>
                    <li><a href="index.html#features">Features</a></li>
                    <li><a href="index.html#testimonials">Reviews</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                    <li><a href="#" id="profileLink">Profile</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle mobile menu" aria-expanded="false">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Registration Section -->
    <section class="auth-container">        
        <!-- Form Card -->
        <div class="auth-card">
            <h2>Signup</h2>
            
            <form id="registerForm">
                <div class="form-group">
                    <input type="text" class="form-control" id="firstName" name="firstName" placeholder="First Name" required>
                    <div class="error-message" id="firstNameError"></div>
                </div>
                
                <div class="form-group">
                    <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Last Name" required>
                    <div class="error-message" id="lastNameError"></div>
                </div>
                
                <div class="form-group">
                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone Number">
                    <div class="error-message" id="phoneError"></div>
                </div>
                
                <div class="form-group">
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                    <div class="error-message" id="emailError"></div>
                </div>
                
                <div class="form-group">
                    <div class="password-input-wrapper">
                        <input type="password" class="form-control" id="password" name="password" placeholder="Create password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('password')" title="Toggle password visibility">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                    <div class="error-message" id="passwordError"></div>
                </div>
                
                <div class="form-group">
                    <div class="password-input-wrapper">
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')" title="Toggle password visibility">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                    <div class="error-message" id="confirmPasswordError"></div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    Signup
                </button>
                
                <div class="auth-footer">
                    <p>Already have an account? <a href="login.html">Login</a></p>
                </div>
                
                <div class="auth-divider">
                    <span>Or</span>
                </div>
                
                <!-- Google Sign-In Button -->
                <div id="g_id_onload"
                     data-client_id="848381710448-e350700oj5m3qg8cjpiaif47hqmfi2ik.apps.googleusercontent.com"
                     data-context="signup"
                     data-ux_mode="popup"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                
                <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="filled_blue"
                     data-text="signup_with"
                     data-size="large"
                     data-logo_alignment="left">
                </div>

                <div class="auth-divider">
                    <span>Admin Access</span>
                </div>
                
                <button type="button" class="btn btn-admin" onclick="redirectToAdmin()">
                    <i class="fas fa-shield-alt"></i>
                    Admin Panel
                </button>
            </form>
        </div>
    </section>

    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script>
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.classList.remove('fa-eye-slash');
                toggle.classList.add('fa-eye');
            } else {
                input.type = 'password';
                toggle.classList.remove('fa-eye');
                toggle.classList.add('fa-eye-slash');
            }
        }
        
        function redirectToAdmin() {
            // Add confirmation for admin access
            if (confirm('Redirecting to Admin Panel. This is for authorized administrators only. Continue?')) {
                window.location.href = 'admin.html';
            }
        }

        // Google OAuth 2.0 Functions for Registration
        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);
            
            // Decode the JWT token to get user information
            const responsePayload = decodeJwtResponse(response.credential);
            
            console.log("ID: " + responsePayload.sub);
            console.log('Full Name: ' + responsePayload.name);
            console.log('Given Name: ' + responsePayload.given_name);
            console.log('Family Name: ' + responsePayload.family_name);
            console.log("Image URL: " + responsePayload.picture);
            console.log("Email: " + responsePayload.email);
            
            // Send user data to your server for registration/authentication
            authenticateWithGoogle({
                id: responsePayload.sub,
                email: responsePayload.email,
                name: responsePayload.name,
                given_name: responsePayload.given_name,
                family_name: responsePayload.family_name,
                picture: responsePayload.picture,
                jwt_token: response.credential,
                is_registration: true // Flag to indicate this is from registration page
            });
        }

        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        async function authenticateWithGoogle(userData) {
            try {
                // Show loading state
                const googleButton = document.querySelector('.g_id_signin');
                if (googleButton) {
                    googleButton.style.opacity = '0.7';
                    googleButton.style.pointerEvents = 'none';
                }

                // Send to server for authentication/registration
                const response = await fetch('php/google_auth.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();

                if (result.success) {
                    // Store user session
                    localStorage.setItem('userLoggedIn', 'true');
                    localStorage.setItem('userEmail', userData.email);
                    localStorage.setItem('userName', userData.name);
                    localStorage.setItem('userPicture', userData.picture);
                    localStorage.setItem('loginMethod', 'google');
                    
                    // Show success message
                    if (userData.is_registration) {
                        alert('Google registration successful! Welcome ' + userData.name);
                    } else {
                        alert('Google login successful! Welcome back ' + userData.name);
                    }
                    
                    // Redirect to profile or dashboard
                    window.location.href = 'profile.html';
                } else {
                    throw new Error(result.message || 'Google authentication failed');
                }
            } catch (error) {
                console.error('Google authentication error:', error);
                alert('Google sign-up failed: ' + error.message);
                
                // Reset button state
                const googleButton = document.querySelector('.g_id_signin');
                if (googleButton) {
                    googleButton.style.opacity = '1';
                    googleButton.style.pointerEvents = 'auto';
                }
            }
        }

        // Initialize Google Sign-In on page load
        window.onload = function () {
            // Google Sign-In will automatically initialize based on the div elements above
            console.log('Google Sign-In initialized for registration page');
        };

        function redirectToAdmin() {
            // Add confirmation for admin access
            if (confirm('Redirecting to Admin Panel. This is for authorized administrators only. Continue?')) {
                window.location.href = 'admin.html';
            }
        }
    </script>
</body>
</html>